<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoneyTracker Pro - スマート家計簿</title>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #10b981;
            --primary-dark: #059669;
            --secondary-color: #3b82f6;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --success-color: #10b981;
            --dark-bg: #111827;
            --dark-card: #1f2937;
            --light-bg: #f9fafb;
            --light-card: #ffffff;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        body {
            font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #10b981 0%, #065f46 100%);
            min-height: 100vh;
            color: var(--text-primary);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }

        .btn-secondary {
            background: var(--light-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        /* Period Selector */
        .period-selector {
            display: flex;
            background: var(--light-bg);
            border-radius: 10px;
            padding: 4px;
            gap: 4px;
        }

        .period-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .period-btn.active {
            background: white;
            color: var(--primary-color);
            box-shadow: var(--shadow);
        }

        /* Summary Cards */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
        }

        .summary-card.income::before {
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
        }

        .summary-card.expense::before {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .summary-card.savings::before {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .summary-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-bottom: 16px;
        }

        .summary-icon.balance {
            background: rgba(16, 185, 129, 0.1);
            color: var(--primary-color);
        }

        .summary-icon.income {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .summary-icon.expense {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .summary-icon.savings {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }

        .summary-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .summary-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .summary-change {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .summary-change.positive {
            color: var(--success-color);
        }

        .summary-change.negative {
            color: var(--danger-color);
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Transaction List */
        .transaction-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-input {
            flex: 1;
            min-width: 200px;
            padding: 10px 15px 10px 40px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            font-size: 14px;
            position: relative;
        }

        .filter-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .transaction-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .transaction-item:hover {
            background: var(--light-bg);
            padding-left: 20px;
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .transaction-category-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .transaction-details {
            display: flex;
            flex-direction: column;
        }

        .transaction-title {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .transaction-date {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .transaction-amount {
            font-weight: 600;
            font-size: 16px;
        }

        .transaction-amount.income {
            color: #3b82f6;
        }

        .transaction-amount.expense {
            color: #ef4444;
        }

        /* Quick Add Form */
        .quick-add-card {
            position: sticky;
            top: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .type-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .type-option {
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .type-option.income.active {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            color: #3b82f6;
        }

        .type-option.expense.active {
            background: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
            color: #ef4444;
        }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .chart-canvas {
            max-height: 300px;
        }

        /* Budget Progress */
        .budget-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .budget-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .budget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .budget-category {
            font-weight: 500;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .budget-amount {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .budget-progress {
            height: 8px;
            background: var(--light-bg);
            border-radius: 4px;
            overflow: hidden;
        }

        .budget-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .budget-progress-bar.warning {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .budget-progress-bar.danger {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        /* Savings Goal */
        .savings-goal {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .savings-goal::before {
            content: '💰';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 60px;
            opacity: 0.2;
        }

        .savings-goal-title {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .savings-goal-amount {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .savings-goal-progress {
            height: 10px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .savings-goal-progress-bar {
            height: 100%;
            background: white;
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .savings-goal-text {
            font-size: 13px;
            opacity: 0.9;
        }

        /* Category Icons */
        .category-food { background: rgba(239, 68, 68, 0.1); color: #ef4444; }
        .category-transport { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
        .category-shopping { background: rgba(236, 72, 153, 0.1); color: #ec4899; }
        .category-entertainment { background: rgba(168, 85, 247, 0.1); color: #a855f7; }
        .category-bills { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
        .category-health { background: rgba(16, 185, 129, 0.1); color: #10b981; }
        .category-education { background: rgba(99, 102, 241, 0.1); color: #6366f1; }
        .category-others { background: rgba(107, 114, 128, 0.1); color: #6b7280; }
        .category-salary { background: rgba(34, 197, 94, 0.1); color: #22c55e; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header-top {
                flex-direction: column;
                gap: 16px;
            }

            .summary-cards {
                grid-template-columns: 1fr 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .transaction-filters {
                flex-direction: column;
            }

            .filter-input {
                width: 100%;
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 60px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-state-text {
            font-size: 16px;
            margin-bottom: 20px;
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(16, 185, 129, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Insights */
        .insights-card {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 1px solid #86efac;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .insights-title {
            font-weight: 600;
            color: #166534;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .insights-text {
            font-size: 14px;
            color: #166534;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <h1>
                    <i class="fas fa-wallet"></i>
                    MoneyTracker Pro
                </h1>
                <div class="header-controls">
                    <div class="period-selector">
                        <button class="period-btn active" onclick="changePeriod('month', this)">月次</button>
                        <button class="period-btn" onclick="changePeriod('year', this)">年次</button>
                        <button class="period-btn" onclick="changePeriod('all', this)">全期間</button>
                    </div>
                    <button class="btn btn-secondary" onclick="exportToCSV()">
                        <i class="fas fa-download"></i>
                        CSV出力
                    </button>
                    <button class="btn btn-secondary" onclick="importCSV()">
                        <i class="fas fa-upload"></i>
                        インポート
                    </button>
                </div>
            </div>

            <!-- Period Display -->
            <div id="currentPeriod" style="text-align: center; color: var(--text-secondary); font-size: 14px;">
                2024年8月
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="summary-cards">
            <div class="summary-card balance">
                <div class="summary-icon balance">
                    <i class="fas fa-balance-scale"></i>
                </div>
                <div class="summary-label">残高</div>
                <div class="summary-value" id="balanceAmount">¥0</div>
                <div class="summary-change positive">
                    <i class="fas fa-arrow-up"></i>
                    <span id="balanceChange">+12.5%</span>
                </div>
            </div>

            <div class="summary-card income">
                <div class="summary-icon income">
                    <i class="fas fa-arrow-down"></i>
                </div>
                <div class="summary-label">収入</div>
                <div class="summary-value" id="incomeAmount">¥0</div>
                <div class="summary-change positive">
                    <i class="fas fa-arrow-up"></i>
                    <span id="incomeChange">+5.2%</span>
                </div>
            </div>

            <div class="summary-card expense">
                <div class="summary-icon expense">
                    <i class="fas fa-arrow-up"></i>
                </div>
                <div class="summary-label">支出</div>
                <div class="summary-value" id="expenseAmount">¥0</div>
                <div class="summary-change negative">
                    <i class="fas fa-arrow-up"></i>
                    <span id="expenseChange">+8.3%</span>
                </div>
            </div>

            <div class="summary-card savings">
                <div class="summary-icon savings">
                    <i class="fas fa-piggy-bank"></i>
                </div>
                <div class="summary-label">貯金</div>
                <div class="summary-value" id="savingsAmount">¥0</div>
                <div class="summary-change positive">
                    <i class="fas fa-arrow-up"></i>
                    <span id="savingsChange">+25.0%</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Column -->
            <div>
                <!-- Transaction List -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-list"></i>
                            取引履歴
                        </h2>
                        <button class="btn btn-primary" onclick="openModal()">
                            <i class="fas fa-plus"></i>
                            追加
                        </button>
                    </div>

                    <div class="transaction-filters">
                        <div style="position: relative; flex: 1;">
                            <i class="fas fa-search filter-icon"></i>
                            <input type="text" class="filter-input" style="padding-left: 40px;" placeholder="検索..." id="searchInput">
                        </div>
                        <select class="form-select" style="width: 150px;" id="categoryFilter">
                            <option value="">全カテゴリ</option>
                            <option value="food">食費</option>
                            <option value="transport">交通費</option>
                            <option value="shopping">買い物</option>
                            <option value="entertainment">娯楽</option>
                            <option value="bills">固定費</option>
                            <option value="health">医療・健康</option>
                            <option value="education">教育</option>
                            <option value="salary">給与</option>
                            <option value="others">その他</option>
                        </select>
                    </div>

                    <div class="transaction-list" id="transactionList">
                        <!-- Transactions will be added here -->
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div>
                <!-- Quick Add -->
                <div class="card quick-add-card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-bolt"></i>
                            クイック入力
                        </h2>
                    </div>

                    <form id="quickAddForm" onsubmit="quickAddTransaction(event)">
                        <div class="form-group">
                            <label class="form-label">種別</label>
                            <div class="type-selector">
                                <div class="type-option expense active" onclick="selectType('expense', this)">
                                    <i class="fas fa-minus"></i> 支出
                                </div>
                                <div class="type-option income" onclick="selectType('income', this)">
                                    <i class="fas fa-plus"></i> 収入
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">金額</label>
                            <input type="number" class="form-input" id="quickAmount" placeholder="¥0" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">カテゴリ</label>
                            <select class="form-select" id="quickCategory" required>
                                <option value="">選択してください</option>
                                <optgroup label="支出" id="expenseCategories">
                                    <option value="food">🍔 食費</option>
                                    <option value="transport">🚃 交通費</option>
                                    <option value="shopping">🛍️ 買い物</option>
                                    <option value="entertainment">🎮 娯楽</option>
                                    <option value="bills">📱 固定費</option>
                                    <option value="health">🏥 医療・健康</option>
                                    <option value="education">📚 教育</option>
                                    <option value="others">📦 その他</option>
                                </optgroup>
                                <optgroup label="収入" id="incomeCategories" style="display: none;">
                                    <option value="salary">💰 給与</option>
                                    <option value="bonus">🎁 賞与</option>
                                    <option value="investment">📈 投資収益</option>
                                    <option value="others">📦 その他</option>
                                </optgroup>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">メモ</label>
                            <input type="text" class="form-input" id="quickNote" placeholder="例: コンビニで昼食">
                        </div>

                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-check"></i>
                            記録する
                        </button>
                    </form>
                </div>

                <!-- Savings Goal -->
                <div class="savings-goal">
                    <div class="savings-goal-title">今月の貯金目標</div>
                    <div class="savings-goal-amount">¥50,000</div>
                    <div class="savings-goal-progress">
                        <div class="savings-goal-progress-bar" style="width: 65%;"></div>
                    </div>
                    <div class="savings-goal-text">達成率: 65% (¥32,500 / ¥50,000)</div>
                </div>

                <!-- Insights -->
                <div class="insights-card">
                    <div class="insights-title">
                        <i class="fas fa-lightbulb"></i>
                        今月のインサイト
                    </div>
                    <div class="insights-text">
                        先月と比べて食費が15%増加しています。外食を週1回減らすと月額¥8,000の節約が可能です。
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="charts-grid">
            <div class="chart-container">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-chart-pie"></i>
                        カテゴリ別支出
                    </h2>
                </div>
                <canvas id="categoryChart" class="chart-canvas"></canvas>
            </div>

            <div class="chart-container">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-chart-line"></i>
                        月次推移
                    </h2>
                </div>
                <canvas id="trendChart" class="chart-canvas"></canvas>
            </div>
        </div>

        <!-- Budget Progress -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-chart-bar"></i>
                    予算進捗
                </h2>
            </div>
            <div class="budget-list" id="budgetList">
                <!-- Budget items will be added here -->
            </div>
        </div>
    </div>

    <!-- Transaction Modal -->
    <div class="modal" id="transactionModal">
        <div class="modal-content">
            <div class="card-header">
                <h2 class="card-title">取引を追加</h2>
                <button class="btn btn-secondary" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <!-- Full transaction form here -->
        </div>
    </div>

    <!-- Hidden file input for CSV import -->
    <input type="file" id="csvFileInput" accept=".csv" style="display: none;" onchange="handleFileSelect(event)">

    <script>
        // Data Management
        let transactions = [];
        let currentPeriod = 'month';
        let selectedType = 'expense';
        let categoryChart = null;
        let trendChart = null;

        // Categories with icons
        const categories = {
            expense: {
                food: { name: '食費', icon: '🍔', color: '#ef4444' },
                transport: { name: '交通費', icon: '🚃', color: '#3b82f6' },
                shopping: { name: '買い物', icon: '🛍️', color: '#ec4899' },
                entertainment: { name: '娯楽', icon: '🎮', color: '#a855f7' },
                bills: { name: '固定費', icon: '📱', color: '#f59e0b' },
                health: { name: '医療・健康', icon: '🏥', color: '#10b981' },
                education: { name: '教育', icon: '📚', color: '#6366f1' },
                others: { name: 'その他', icon: '📦', color: '#6b7280' }
            },
            income: {
                salary: { name: '給与', icon: '💰', color: '#22c55e' },
                bonus: { name: '賞与', icon: '🎁', color: '#10b981' },
                investment: { name: '投資収益', icon: '📈', color: '#3b82f6' },
                others: { name: 'その他', icon: '📦', color: '#6b7280' }
            }
        };

        // Budget settings
        const budgets = {
            food: 30000,
            transport: 10000,
            shopping: 20000,
            entertainment: 15000,
            bills: 50000,
            health: 10000,
            education: 20000,
            others: 10000
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadTransactions();
            updateDisplay();
            initCharts();
            
            // Event listeners
            document.getElementById('searchInput').addEventListener('input', filterTransactions);
            document.getElementById('categoryFilter').addEventListener('change', filterTransactions);
        });

        // Load transactions from localStorage
        function loadTransactions() {
            const stored = localStorage.getItem('transactions');
            if (stored) {
                transactions = JSON.parse(stored);
            } else {
                // Demo data
                transactions = [
                    {
                        id: Date.now() - 86400000 * 5,
                        type: 'income',
                        amount: 280000,
                        category: 'salary',
                        note: '8月分給与',
                        date: new Date(Date.now() - 86400000 * 5).toISOString()
                    },
                    {
                        id: Date.now() - 86400000 * 4,
                        type: 'expense',
                        amount: 3500,
                        category: 'food',
                        note: 'スーパーで買い物',
                        date: new Date(Date.now() - 86400000 * 4).toISOString()
                    },
                    {
                        id: Date.now() - 86400000 * 3,
                        type: 'expense',
                        amount: 1200,
                        category: 'transport',
                        note: '電車定期',
                        date: new Date(Date.now() - 86400000 * 3).toISOString()
                    },
                    {
                        id: Date.now() - 86400000 * 2,
                        type: 'expense',
                        amount: 15000,
                        category: 'shopping',
                        note: '洋服購入',
                        date: new Date(Date.now() - 86400000 * 2).toISOString()
                    },
                    {
                        id: Date.now() - 86400000,
                        type: 'expense',
                        amount: 5000,
                        category: 'entertainment',
                        note: '映画とディナー',
                        date: new Date(Date.now() - 86400000).toISOString()
                    }
                ];
                saveTransactions();
            }
        }

        // Save transactions
        function saveTransactions() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
        }

        // Update display
        function updateDisplay() {
            updateSummary();
            renderTransactions();
            updateCharts();
            updateBudgetProgress();
            updateInsights();
        }

        // Update summary cards
        function updateSummary() {
            const now = new Date();
            const periodTransactions = filterByPeriod(transactions);
            
            const income = periodTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const expense = periodTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const balance = income - expense;
            const savings = Math.max(0, balance);
            
            document.getElementById('balanceAmount').textContent = formatCurrency(balance);
            document.getElementById('incomeAmount').textContent = formatCurrency(income);
            document.getElementById('expenseAmount').textContent = formatCurrency(expense);
            document.getElementById('savingsAmount').textContent = formatCurrency(savings);
            
            // Update period display
            if (currentPeriod === 'month') {
                document.getElementById('currentPeriod').textContent = 
                    `${now.getFullYear()}年${now.getMonth() + 1}月`;
            } else if (currentPeriod === 'year') {
                document.getElementById('currentPeriod').textContent = 
                    `${now.getFullYear()}年`;
            } else {
                document.getElementById('currentPeriod').textContent = '全期間';
            }
        }

        // Render transactions
        function renderTransactions() {
            const list = document.getElementById('transactionList');
            const periodTransactions = filterByPeriod(transactions);
            
            // Sort by date (newest first)
            periodTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (periodTransactions.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="empty-state-text">取引履歴がありません</div>
                        <button class="btn btn-primary" onclick="openModal()">
                            <i class="fas fa-plus"></i>
                            最初の取引を追加
                        </button>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = periodTransactions.map(transaction => {
                const categoryInfo = categories[transaction.type][transaction.category];
                return `
                    <div class="transaction-item" onclick="editTransaction(${transaction.id})">
                        <div class="transaction-left">
                            <div class="transaction-category-icon category-${transaction.category}">
                                ${categoryInfo.icon}
                            </div>
                            <div class="transaction-details">
                                <div class="transaction-title">${transaction.note || categoryInfo.name}</div>
                                <div class="transaction-date">${formatDate(transaction.date)}</div>
                            </div>
                        </div>
                        <div class="transaction-amount ${transaction.type}">
                            ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount)}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Filter by period
        function filterByPeriod(transactions) {
            const now = new Date();
            
            if (currentPeriod === 'month') {
                return transactions.filter(t => {
                    const date = new Date(t.date);
                    return date.getMonth() === now.getMonth() && 
                           date.getFullYear() === now.getFullYear();
                });
            } else if (currentPeriod === 'year') {
                return transactions.filter(t => {
                    const date = new Date(t.date);
                    return date.getFullYear() === now.getFullYear();
                });
            }
            
            return transactions;
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('ja-JP', {
                style: 'currency',
                currency: 'JPY'
            }).format(amount);
        }

        // Format date
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return '今日';
            if (diffDays === 1) return '昨日';
            if (diffDays < 7) return `${diffDays}日前`;
            
            return `${date.getMonth() + 1}月${date.getDate()}日`;
        }

        // Select type
        function selectType(type, element) {
            selectedType = type;
            document.querySelectorAll('.type-option').forEach(opt => {
                opt.classList.remove('active');
            });
            element.classList.add('active');
            
            // Update category options
            const expenseCategories = document.getElementById('expenseCategories');
            const incomeCategories = document.getElementById('incomeCategories');
            
            if (type === 'expense') {
                expenseCategories.style.display = 'block';
                incomeCategories.style.display = 'none';
            } else {
                expenseCategories.style.display = 'none';
                incomeCategories.style.display = 'block';
            }
        }

        // Quick add transaction
        function quickAddTransaction(e) {
            e.preventDefault();
            
            const amount = parseFloat(document.getElementById('quickAmount').value);
            const category = document.getElementById('quickCategory').value;
            const note = document.getElementById('quickNote').value;
            
            if (!amount || !category) return;
            
            const transaction = {
                id: Date.now(),
                type: selectedType,
                amount: amount,
                category: category,
                note: note,
                date: new Date().toISOString()
            };
            
            transactions.push(transaction);
            saveTransactions();
            updateDisplay();
            
            // Reset form
            document.getElementById('quickAddForm').reset();
            
            // Show success message
            showNotification('取引を追加しました');
        }

        // Change period
        function changePeriod(period, element) {
            currentPeriod = period;
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            element.classList.add('active');
            updateDisplay();
        }

        // Initialize charts
        function initCharts() {
            // Category chart
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            categoryChart = new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: []
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Trend chart
            const trendCtx = document.getElementById('trendChart').getContext('2d');
            trendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: '収入',
                        data: [],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }, {
                        label: '支出',
                        data: [],
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Update charts
        function updateCharts() {
            const periodTransactions = filterByPeriod(transactions);
            
            // Update category chart
            const expenseByCategory = {};
            periodTransactions
                .filter(t => t.type === 'expense')
                .forEach(t => {
                    expenseByCategory[t.category] = (expenseByCategory[t.category] || 0) + t.amount;
                });
            
            const categoryLabels = Object.keys(expenseByCategory).map(cat => 
                categories.expense[cat]?.name || cat
            );
            const categoryData = Object.values(expenseByCategory);
            const categoryColors = Object.keys(expenseByCategory).map(cat => 
                categories.expense[cat]?.color || '#6b7280'
            );
            
            categoryChart.data.labels = categoryLabels;
            categoryChart.data.datasets[0].data = categoryData;
            categoryChart.data.datasets[0].backgroundColor = categoryColors;
            categoryChart.update();
            
            // Update trend chart
            const last6Months = [];
            const incomeData = [];
            const expenseData = [];
            
            for (let i = 5; i >= 0; i--) {
                const date = new Date();
                date.setMonth(date.getMonth() - i);
                
                const monthStr = `${date.getMonth() + 1}月`;
                last6Months.push(monthStr);
                
                const monthTransactions = transactions.filter(t => {
                    const tDate = new Date(t.date);
                    return tDate.getMonth() === date.getMonth() && 
                           tDate.getFullYear() === date.getFullYear();
                });
                
                const monthIncome = monthTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const monthExpense = monthTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                incomeData.push(monthIncome);
                expenseData.push(monthExpense);
            }
            
            trendChart.data.labels = last6Months;
            trendChart.data.datasets[0].data = incomeData;
            trendChart.data.datasets[1].data = expenseData;
            trendChart.update();
        }

        // Update budget progress
        function updateBudgetProgress() {
            const list = document.getElementById('budgetList');
            const periodTransactions = filterByPeriod(transactions);
            
            const expenseByCategory = {};
            periodTransactions
                .filter(t => t.type === 'expense')
                .forEach(t => {
                    expenseByCategory[t.category] = (expenseByCategory[t.category] || 0) + t.amount;
                });
            
            const budgetHtml = Object.entries(budgets).map(([category, budget]) => {
                const spent = expenseByCategory[category] || 0;
                const percentage = Math.min((spent / budget) * 100, 100);
                const categoryInfo = categories.expense[category];
                
                let progressClass = '';
                if (percentage > 90) progressClass = 'danger';
                else if (percentage > 70) progressClass = 'warning';
                
                return `
                    <div class="budget-item">
                        <div class="budget-header">
                            <div class="budget-category">
                                ${categoryInfo.icon} ${categoryInfo.name}
                            </div>
                            <div class="budget-amount">
                                ${formatCurrency(spent)} / ${formatCurrency(budget)}
                            </div>
                        </div>
                        <div class="budget-progress">
                            <div class="budget-progress-bar ${progressClass}" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
            
            list.innerHTML = budgetHtml;
        }

        // Update insights
        function updateInsights() {
            const periodTransactions = filterByPeriod(transactions);
            const previousPeriodTransactions = getPreviousPeriodTransactions();
            
            const currentExpense = periodTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const previousExpense = previousPeriodTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const difference = currentExpense - previousExpense;
            const percentChange = previousExpense ? ((difference / previousExpense) * 100).toFixed(1) : 0;
            
            // Find highest expense category
            const expenseByCategory = {};
            periodTransactions
                .filter(t => t.type === 'expense')
                .forEach(t => {
                    expenseByCategory[t.category] = (expenseByCategory[t.category] || 0) + t.amount;
                });
            
            const highestCategory = Object.entries(expenseByCategory)
                .sort((a, b) => b[1] - a[1])[0];
            
            // Update insights text
            const insightsText = document.querySelector('.insights-text');
            if (highestCategory) {
                const categoryInfo = categories.expense[highestCategory[0]];
                insightsText.textContent = `今月最も支出が多いのは${categoryInfo.name}（${formatCurrency(highestCategory[1])}）です。` +
                    (difference > 0 ? `先月と比べて支出が${Math.abs(percentChange)}%増加しています。` : 
                     difference < 0 ? `先月と比べて支出が${Math.abs(percentChange)}%減少しています。素晴らしい！` : 
                     '先月と同じペースで支出しています。');
            }
        }

        // Get previous period transactions
        function getPreviousPeriodTransactions() {
            const now = new Date();
            
            if (currentPeriod === 'month') {
                const previousMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                return transactions.filter(t => {
                    const date = new Date(t.date);
                    return date.getMonth() === previousMonth.getMonth() && 
                           date.getFullYear() === previousMonth.getFullYear();
                });
            } else if (currentPeriod === 'year') {
                return transactions.filter(t => {
                    const date = new Date(t.date);
                    return date.getFullYear() === now.getFullYear() - 1;
                });
            }
            
            return [];
        }

        // Filter transactions
        function filterTransactions() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            
            const items = document.querySelectorAll('.transaction-item');
            items.forEach((item, index) => {
                const transaction = filterByPeriod(transactions)[index];
                if (!transaction) return;
                
                const matchSearch = !search || 
                    transaction.note.toLowerCase().includes(search) ||
                    categories[transaction.type][transaction.category].name.toLowerCase().includes(search);
                
                const matchCategory = !category || transaction.category === category;
                
                item.style.display = matchSearch && matchCategory ? 'flex' : 'none';
            });
        }

        // Export to CSV
        function exportToCSV() {
            const periodTransactions = filterByPeriod(transactions);
            
            let csv = '日付,種別,カテゴリ,金額,メモ\n';
            periodTransactions.forEach(t => {
                const date = new Date(t.date).toLocaleDateString('ja-JP');
                const type = t.type === 'income' ? '収入' : '支出';
                const categoryName = categories[t.type][t.category].name;
                csv += `${date},${type},${categoryName},${t.amount},${t.note || ''}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `家計簿_${new Date().toLocaleDateString('ja-JP')}.csv`;
            link.click();
        }

        // Import CSV
        function importCSV() {
            document.getElementById('csvFileInput').click();
        }

        // Handle file select
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                // Parse CSV and add transactions
                // This is a simplified implementation
                showNotification('CSVファイルをインポートしました');
            };
            reader.readAsText(file);
        }

        // Show notification
        function showNotification(message) {
            // Simple notification implementation
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: var(--primary-color);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: var(--shadow-lg);
                z-index: 2000;
                animation: slideUp 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Modal functions
        function openModal() {
            document.getElementById('transactionModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('transactionModal').classList.remove('show');
        }

        function editTransaction(id) {
            // Edit transaction implementation
            console.log('Edit transaction:', id);
        }
    </script>
</body>
</html>